name: Update Fission IP

on:
#  schedule:
#    - cron: '0 0 * * *'  # UTC 时间 00:00 对应北京时间 08:00
  workflow_dispatch:  # 允许手动触发

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2  # 使用actions/checkout来拉取代码仓库

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        echo "Installing dependencies..."
        python -m pip install --upgrade pip
        pip install selenium webdriver-manager
        pip freeze

    - name: Download ChromeDriver
      run: |
        echo "Downloading and setting up ChromeDriver..."
        wget https://chromedriver.storage.googleapis.com/114.0.5735.90/chromedriver_linux64.zip
        unzip chromedriver_linux64.zip
        mv chromedriver /usr/local/bin/
        chromedriver --version

    - name: Run the Python script
      run: |
        echo "Running the Python scraping script..."
        python Get-IP.py
        echo "Script execution finished."

    - name: Commit the result to GitHub
      run: |
        echo "Committing changes to GitHub..."
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        git add Fission_ip.txt
        git commit -m "Update Fission_ip.txt with top 3 IP addresses"
        git push
        echo "Changes pushed to repository."

          # 等待 5 秒
    - name: Wait 5 seconds
      run: sleep 5

      # 触发 bestdns.yaml
    - name: Trigger BestDNS Workflow
      uses: peter-evans/repository-dispatch@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        event-type: bestdns-update # 自定义事件名称
